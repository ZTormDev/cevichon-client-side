const productos = [

    // CEVICHES CAMARON O SALMON O MACHA  
    {
      nombre: 'Cevichón',
      tamaño: '300g', 
      imagen: '/ceviches/ceviche300g.png',
      descripcionCorta: 'Elige entre Camarón, Salmón o Macha.',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$4.500',
      precioActual: '$3.500',
      seleccion: 'si',
      tipoSeleccion: ['Camarón', 'Salmón', 'Macha'],
      cantidad: '1'
    },
    {
      nombre: 'Cevichón',
      tamaño: '500g', 
      imagen: '/ceviches/cevich.png',
      descripcionCorta: 'Elige entre Camarón, Salmón o Macha.',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$7.500',
      precioActual: '$6.000',
      seleccion: 'si',
      tipoSeleccion: ['Camarón', 'Salmón', 'Macha'],
      cantidad: '1'
    },
    {
      nombre: 'Cevichón',
      tamaño: '1kg', 
      imagen: '/ceviches/ceviche.png',
      descripcionCorta: 'Elige entre Camarón, Salmón o Macha.',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$11.500',
      precioActual: '$10.500',
      seleccion: 'si',
      tipoSeleccion: ['Camarón', 'Salmón', 'Macha'],
      cantidad: '1'
    },


    // CEVICHES CAMARON Y SALMON
    {
      nombre: 'Cevichón',
      tamaño: '300g', 
      imagen: '/ceviches/ceviche300g-salmoncamaron.png',
      descripcionCorta: 'Camarón y Salmón.',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$5.000',
      precioActual: '$4.000',
      cantidad: '1'
    },
    {
      nombre: 'Cevichón',
      tamaño: '500g', 
      imagen: '/ceviches/ceviche500g-camaronsalmon.png',
      descripcionCorta: 'Camarón y Salmón.',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$7.500',
      precioActual: '$6.500',
      cantidad: '1'
    },
    {
      nombre: 'Cevichón',
      tamaño: '1kg', 
      imagen: '/ceviches/ceviche1kg-camaronsalmon.png',
      descripcionCorta: 'Camarón y Salmón.',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$13.000',
      precioActual: '$12.000',
      cantidad: '1'
    },


    // CEVICHES MACHA SALMON O MACHA CAMARON
    {
      nombre: 'Cevichón',
      tamaño: '300g', 
      imagen: '/ceviches/ceviche300g-machasalmonomachacamaron.png',
      descripcionCorta: 'Elije entre Macha y Salmón o Macha y Camarón',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$5.000',
      precioActual: '$4.000',
      seleccion: 'si',
      tipoSeleccion: ['Macha y Salmon','Macha y Camaron'],
      cantidad: '1'
    },
    {
      nombre: 'Cevichón',
      tamaño: '500g', 
      imagen: '/ceviches/cevic.jpg',
      descripcionCorta: 'Elije entre Macha y Salmón o Macha y Camarón',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$7.500',
      precioActual: '$6.500',
      seleccion: 'si',
      tipoSeleccion: ['Macha y Salmon','Macha y Camaron'],
      cantidad: '1'
    },
    {
      nombre: 'Cevichón',
      tamaño: '1kg', 
      imagen: '/ceviches/cevich.png',
      descripcionCorta: 'Elije entre Macha y Salmón o Macha y Camarón',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$13.000',
      precioActual: '$12.000',
      seleccion: 'si',
      tipoSeleccion: ['Macha y Salmon','Macha y Camaron'],
      cantidad: '1'
    },


    // CEVICHES SALMON CAMARON Y MACHA || TRILOGIA MARINA
    {
      nombre: 'Trilogia Marina',
      tamaño: '300g', 
      imagen: '/ceviches/ceviche300g-trilogiamarina.png',
      descripcionCorta: 'Salmon, Camaron y Macha',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$5.500',
      precioActual: '$4.500',
      cantidad: '1'
    },
    {
      nombre: 'Trilogia Marina',
        tamaño: '500g', 
        imagen: '/ceviches/ceviche500g-trilogiamarina.png',
        descripcionCorta: 'Salmon, Camaron y Macha',
        descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
        precioAnterior: '$8.500',
        precioActual: '$7.500',
        cantidad: '1'
    },
    {
      nombre: 'Trilogia Marina',
      tamaño: '1kg', 
      imagen: '/ceviches/ceviche1kg-trilogiamarina.png',
      descripcionCorta: 'Salmon, Camaron y Macha',
      descripcion: 'Cevichon Macha, Camaron, Salmon, con maiz/choclo, pimenton verde y un poco de aji, mas unas 3 tostadas de oregano y mantequilla.',
      precioAnterior: '$14.000',
      precioActual: '$13.000',
      cantidad: '1'
    },



    // AGREGADOSSSSS
    {
      nombre: 'Tostadas',
      tamaño: '3 uds', 
      imagen: '/agregados/tostadas.png',
      descripcionCorta: 'Tostadas de oregano y mantequilla',
      descripcion: 'Tostaditas cubiertas con mantequilla y un liguero toque de oregano lo cual es conveniente con un buen ceviche.',
      precioAnterior: '$2.000',
      precioActual: '$1.000',
      cantidad: '1'
    },
    {
      nombre: 'Salsa de Cilantro',
      tamaño: '1 uds', 
      imagen: '/agregados/salsadeajo.png',
      descripcionCorta: 'Deliciosa lactonesa echa a base leche..',
      descripcion: 'Deliciosa lactonesa echa a base leche, ajo, aceite, limón, sal y cilantro, acompañado de la magia de la casa.',
      precioAnterior: '$1.000',
      precioActual: '$500',
      cantidad: '1'
    },
];



const ItemPreviewContainer = document.getElementById('product-preview-container');
const ItemPreview = document.getElementById('product-preview');

const productPreviewTitle = document.querySelector('.product-preview-title');
const productPreviewImage = document.querySelector('.product-preview-image');
const productPreviewDetails = document.querySelector('.product-preview-details');
const productPreviewPriceAnterior = document.querySelector('.product-preview-price-anterior');
const productPreviewPrice = document.querySelector('.product-preview-price');
const productPreviewPedirButton = document.querySelector('.pedir-button');

const seleccionContainer = document.querySelector('.seleccion-container');
const seleccionButtons = document.querySelector('.seleccion-buttons');

const cantidadText = document.querySelector('.cantidad');
const sumarButton = document.querySelector('.sumar');
const restarButton = document.querySelector('.restar');

function generarProductos() {
    const productosContainer = document.querySelector('.productos-container');
  
    productos.forEach((producto, index) => {
      const article = document.createElement('article');
      article.onclick = () => mostrarDetalleProducto(producto);

      article.id = `producto-${index + 1}`;
  
      article.innerHTML = `
        <div class='image-container'>
            <img class='imagenProducto' src="./assets/${producto.imagen}" alt="${producto.nombre}" />
        </div>
        <div class='product-details'>
            <div class="text-details">
                <h2 class='nombreProducto'>${producto.nombre} <p class="tamaño-ceviche">${producto.tamaño}</p></h2>
                <p>${producto.descripcionCorta}</p>
            </div>
            <div class='precio-container'>
                <p class="precio-anterior">${producto.precioAnterior}</p>
                <p class='precioProducto'>${producto.precioActual}</p>
            </div>
        </div>
      `;
  
      productosContainer.appendChild(article);
    });
  }

  // Función para aumentar la cantidad
  function sumar(producto) {
    let cantidad = parseInt(cantidadText.innerHTML);
    cantidad++;
    cantidadText.innerHTML = cantidad;
    // Actualizar la cantidad en el objeto de producto
    producto.cantidad = cantidad.toString();
    // Actualizar el enlace del botón "Pedir" con la nueva cantidad
    actualizarEnlacePedir(producto);
  }

  // Función para disminuir la cantidad
  function restar(producto) {
    let cantidad = parseInt(cantidadText.innerHTML);
    if (cantidad > 1) {
        cantidad--;
        cantidadText.innerHTML = cantidad;
        // Actualizar la cantidad en el objeto de producto
        producto.cantidad = cantidad.toString();
        // Actualizar el enlace del botón "Pedir" con la nueva cantidad
        actualizarEnlacePedir(producto);
    }
  }

  // Función para actualizar el enlace del botón "Pedir" con la cantidad seleccionada
  function actualizarEnlacePedir(producto) {
    const datosGuardados = localStorage.getItem('datosCliente');
    const datos = JSON.parse(datosGuardados);

    let cantidad = parseInt(cantidadText.innerHTML);

    let precioProducto = producto.precioActual.replace(/\./g, '').replace('$', '');

    let total = precioProducto * cantidad;
    let precioTotalConPuntos = total.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');

    let mensajeCantidad = producto.seleccion === 'si' ? `Seleccion: *${seleccionButtons.querySelector('.active').textContent}*, ` : ``;

    if (datosGuardados) {
      let telefonoCodificado = encodeURIComponent(`${datos.telefono}`);
      productPreviewPedirButton.setAttribute('href', `https://wa.me/56963360528?text=Hola, este es mi pedido:%0A*${producto.nombre}*%0ATamaño: *${producto.tamaño}*%0ACantidad: *${cantidad}*%0A${mensajeCantidad}%0ATotal: *$${precioTotalConPuntos}*%0A%0AMi datos son:%0ANombre: *${datos.nombre}*%0ATelefono: *${telefonoCodificado}*%0ADireccion: *${datos.direccion}*%0AComuna: *${datos.comuna}*%0AReferencias: *${datos.referencia}*`);
    }
    else {
      productPreviewPedirButton.removeAttribute('href');
      productPreviewPedirButton.setAttribute('onclick', 'mostrarAlertaPedir()');
    }
  }

  const alertaPedirContainer = document.querySelector('.alerta-pedir-container');

  function mostrarAlertaPedir() {
    alertaPedirContainer.style.display = 'flex';
    ItemPreviewContainer.classList.add('hidden');
  }

  function ocultarAlertaPedir() {
    alertaPedirContainer.style.display = 'none';
  }

  function mostrarIngresarDatos() {
    alertaPedirContainer.style.display = 'none';
    datosBG.style.display = 'flex';
  }

  function mostrarDetalleProducto(producto) {
    productPreviewTitle.innerHTML = `${producto.nombre} <p class="preview-tamaño-ceviche">${producto.tamaño}</p>`;
    productPreviewImage.src = `./assets/${producto.imagen}`;
    productPreviewDetails.innerHTML = producto.descripcion;
    productPreviewPriceAnterior.innerHTML = producto.precioAnterior;
    productPreviewPrice.innerHTML = producto.precioActual;

    const datosGuardados = localStorage.getItem('datosCliente');
    const datos = JSON.parse(datosGuardados);

    productPreviewPedirButton.classList.remove('disabled');
    productPreviewPedirButton.removeAttribute('href');
    productPreviewPedirButton.removeAttribute('onclick');

    if (datosGuardados) { 
      //AQUI ACTUALIZAR EL LINKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
      let telefonoCodificado = encodeURIComponent(`${datos.telefono}`);
      productPreviewPedirButton.setAttribute('href', `https://wa.me/56963360528?text=Hola, este es mi pedido:%0A*${producto.nombre}*%0ATamaño: *${producto.tamaño}*%0ACantidad: *${cantidadText.innerHTML}*%0ATotal: *${producto.precioActual}*%0A%0AMi datos son:%0ANombre: *${datos.nombre}*%0ATelefono: *${telefonoCodificado}*%0ADireccion: *${datos.direccion}*%0AComuna: *${datos.comuna}*%0AReferencias: *${datos.referencia}*`);
    } 
    else {
      productPreviewPedirButton.removeAttribute('href');
      productPreviewPedirButton.classList.remove('disabled');

      if(producto.seleccion != 'si') {
        productPreviewPedirButton.setAttribute('onclick', 'mostrarAlertaPedir()');  
      }
    }
    


    cantidadText.innerHTML = `${producto.cantidad}`;
    sumarButton.onclick = () => sumar(producto);
    restarButton.onclick = () => restar(producto);

    ItemPreviewContainer.classList.remove('hidden');
    ItemPreview.classList.add('enterAnimation');


    if(producto.seleccion == 'si') {
      seleccionContainer.classList.remove('hidden')
      seleccionButtons.innerHTML = '';

      productPreviewPedirButton.classList.add('disabled');
      productPreviewPedirButton.removeAttribute('href');

      producto.tipoSeleccion.forEach(tipo => {
        const button = document.createElement('button');
        button.classList.add('seleccion-button');
        button.textContent = tipo;
        button.onclick = () => {
            // Iterar sobre todos los botones dentro de seleccionButtons
            seleccionButtons.querySelectorAll('button').forEach(btn => {
                // Eliminar la clase 'active' de cada botón
                btn.classList.remove('active');
            });
            // Agregar la clase 'active' al botón actual
            button.classList.add('active');
            // Actualizar el enlace del botón "Pedir" con la nueva selección
            productPreviewPedirButton.classList.remove('disabled');

            if (datosGuardados) {
              let cantidad = parseInt(cantidadText.innerHTML);
              let precioProducto = producto.precioActual.replace(/\./g, '').replace('$', '');
              let total = precioProducto * cantidad;
              let precioTotalConPuntos = total.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
              let telefonoCodificado = encodeURIComponent(`${datos.telefono}`);
              productPreviewPedirButton.setAttribute('href', `https://wa.me/56963360528?text=Hola, este es mi pedido:%0A*${producto.nombre}*%0ATamaño: *${producto.tamaño}*%0ASeleccion: *${tipo}*%0ACantidad: *${cantidadText.innerHTML}*%0ATotal: *$${precioTotalConPuntos}*%0A%0AMi datos son:%0ANombre: *${datos.nombre}*%0ATelefono: *${telefonoCodificado}*%0ADireccion: *${datos.direccion}*%0AComuna: *${datos.comuna}*%0AReferencias: *${datos.referencia}*`);
            }
            else {
              productPreviewPedirButton.removeAttribute('href');
              productPreviewPedirButton.setAttribute('onclick', 'mostrarAlertaPedir()');
            }
            
        };
        seleccionButtons.appendChild(button);
    });
    }
    else {
      seleccionContainer.classList.add('hidden')
    }

  }

  function closeItemPreview() {
    ItemPreviewContainer.classList.add('hidden');
    ItemPreview.classList.remove('enterAnimation')
  }


  const datosBG = document.querySelector('.datos-container-bg');

  function mostrarDatos() {
    datosBG.style.display = 'flex';
  }

  function ocultarDatos() {
    datosBG.style.display = 'none';
  }

  document.addEventListener('DOMContentLoaded', function() {
    const nombreInput = document.querySelector('input[name="nombre"]');
    const telefonoInput = document.querySelector('input[name="telefono"]');
    const direccionInput = document.querySelector('input[name="direccion"]');
    const comunaInput = document.querySelector('input[name="comuna"]');
    const numeroInput = document.querySelector('input[name="referencia"]');
    const placeholdenButtonConfirmar = document.querySelector('.confirmar-placeholder');
    const confirmarButton = document.getElementById('confirmar-button');
    const regexNumeros = /^\+?[0-9]+$/;


    function guardarDatosLocalStorage() {
      const datos = {
          nombre: nombreInput.value.trim(),
          telefono: telefonoInput.value.trim(),
          direccion: direccionInput.value.trim(),
          comuna: comunaInput.value.trim(),
          referencia: numeroInput.value.trim()
      };
      localStorage.setItem('datosCliente', JSON.stringify(datos));
  }

  function cargarDatosLocalStorage() {
      const textoDatosCliente = document.querySelector('.direccion-button');
      const datosGuardados = localStorage.getItem('datosCliente');
      if (datosGuardados) {
          const datos = JSON.parse(datosGuardados);
          nombreInput.value = datos.nombre;
          telefonoInput.value = datos.telefono;
          direccionInput.value = datos.direccion;
          comunaInput.value = datos.comuna;
          numeroInput.value = datos.referencia;
          actualizarEstiloConfirmar();
          textoDatosCliente.innerHTML = `${datos.nombre} <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path opacity="0.5" d="M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" fill="#ffffff"></path> <path d="M16.807 19.0112C15.4398 19.9504 13.7841 20.5 12 20.5C10.2159 20.5 8.56023 19.9503 7.193 19.0111C6.58915 18.5963 6.33109 17.8062 6.68219 17.1632C7.41001 15.8302 8.90973 15 12 15C15.0903 15 16.59 15.8303 17.3178 17.1632C17.6689 17.8062 17.4108 18.5964 16.807 19.0112Z" fill="#ffffff"></path> <path d="M12 12C13.6569 12 15 10.6569 15 9C15 7.34315 13.6569 6 12 6C10.3432 6 9.00004 7.34315 9.00004 9C9.00004 10.6569 10.3432 12 12 12Z" fill="#ffffff"></path> </g></svg>`;
      }
  }

    // Función para verificar si todos los campos están completos
    function verificarDatosCompletos() {
        return (
            nombreInput.value.trim().toLowerCase() !== '' &&
            regexNumeros.test(telefonoInput.value.trim().toLowerCase().replace(/\s/g, '')) &&
            telefonoInput.value.trim().toLowerCase().replace(/\s/g, '').length >= 9 &&
            telefonoInput.value.trim().toLowerCase().replace(/\s/g, '').length <= 12 &&
            direccionInput.value.trim().toLowerCase() !== '' &&
            numeroInput.value.trim().toLowerCase() !== '' &&
            comunaInput.value.trim().toLowerCase() === 'concepcion' || comunaInput.value.trim().toLowerCase() === 'concepción'
            
        );
    }
    const inputComuna = document.querySelector('input[name="comuna"]');
    const inputTelefono = document.querySelector('input[name="telefono"]');
    const alertaComuna = document.querySelector('.alerta-comuna');
    const alertaTelefono = document.querySelector('.alerta-telefono');
  
    inputComuna.addEventListener('input', function() {
      const comunaValue = inputComuna.value.trim().toLowerCase();
  
      if (comunaValue !== 'concepcion' && comunaValue !== 'concepción') {
        alertaComuna.classList.remove('hidden');
      } else {
        alertaComuna.classList.add('hidden');
      }
  });

  inputTelefono.addEventListener('input', function() {
    const telefonoValue = inputTelefono.value.trim().toLowerCase().replace(/\s/g, '');

    if (telefonoValue.length >= 9 && telefonoValue.length <= 12 && regexNumeros.test(telefonoValue)) {
      alertaTelefono.classList.add('hidden');
    } else {
      alertaTelefono.classList.remove('hidden');
    }
});

    
    // Función para ocultar el contenedor de fondo
    function ocultarDatosContainer() {
      datosBG.style.display = 'none';
      guardarDatosLocalStorage();
    }

  // Función para actualizar el estilo del botón "Confirmar datos"
  function actualizarEstiloConfirmar() {
      if (verificarDatosCompletos()) {
          confirmarButton.style.opacity = '1';
          confirmarButton.style.cursor = 'pointer';
          placeholdenButtonConfirmar.classList.add('hidden');
          confirmarButton.onclick = ocultarDatosContainer;
      } else {
          confirmarButton.style.opacity = '0.5'; // O cualquier otro valor de opacidad que desees
          confirmarButton.style.cursor = 'default';
          placeholdenButtonConfirmar.classList.remove('hidden');
      }
  }

    // Agregar evento input a los campos de entrada
    nombreInput.addEventListener('input', actualizarEstiloConfirmar);
    telefonoInput.addEventListener('input', actualizarEstiloConfirmar);
    direccionInput.addEventListener('input', actualizarEstiloConfirmar);
    comunaInput.addEventListener('input', actualizarEstiloConfirmar);
    numeroInput.addEventListener('input', actualizarEstiloConfirmar);

  window.onload = function() {
    cargarDatosLocalStorage();
    generarProductos(); // Esta función debería estar disponible aquí si no está declarada globalmente
};

});
